<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vintage64 | Personal Vault</title>
    
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data: 'unsafe-inline' 'unsafe-eval'; script-src 'self' https: 'unsafe-inline' 'unsafe-eval'; style-src 'self' https: 'unsafe-inline'; img-src 'self' https: data:; connect-src 'self' https:;">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <meta property="og:title" content="Vintage64 | The Watch Tower">
    <meta property="og:description" content="Unfiltered reports and observations from the tower.">
    <meta property="og:image" content="https://raw.githubusercontent.com/kdbush64-create/otd-vault/main/telescope-clean.jpg">
    <meta property="og:url" content="https://kdbush64-create.github.io/otd-vault/">
    <meta property="og:type" content="website">

    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
    
    <style>
    .typewriter {
        color: var(--accent) !important; 
        text-shadow: var(--glow);
        display: inline-block;
        overflow: hidden;
        white-space: nowrap;
        letter-spacing: .10em;
        width: 0;
        animation: typing 1.5s steps(20, end) forwards;
    }

    .delay-type {
        animation: typing 1.5s steps(20, end) 1s forwards, blink-caret .75s step-end infinite;
        border-right: .15em solid var(--primary); 
        padding-right: 4px;
    }

    @keyframes typing { from { width: 0 } to { width: 100% } }
    @keyframes blink-caret { 50% { border-color: transparent; } }

    .submit-btn.active {
        font-weight: 900 !important;
        transform: scale(1.05);
    }

    /* Mobile Scaling Fix for Headers */
    .blog-post-body h1, .blog-post-body h2 {
        white-space: normal !important;
        overflow-wrap: break-word !important;
        word-break: break-word;
        line-height: 1.2;
    }
    </style>
</head>

<body id="personal-identity">
    <div class="terminal-overlay"></div>
    <div class="container">

        <header>
            <div style="display: flex; flex-direction: column; align-items: center; gap: 15px;">
                <div class="warning-banner" style="width: 95%; max-width: 800px; color: var(--primary); border: 1px solid var(--primary); padding: 20px; background: var(--box-bg); text-align: center; box-sizing: border-box;">
                    <span class="blink" style="font-weight: bold;">!! WARNING: !!</span> <br> 
                    <span style="font-size: 0.85em; letter-spacing: 1px; display: block; margin-bottom: 12px; white-space: normal;">UNFILTERED OPINIONS AHEAD</span>
                    
                    <div style="border-top: 1px dashed var(--border); padding-top: 12px; margin-top: 10px;">
                        <span class="system-status" style="display: block; font-size: 0.75em; line-height: 1.6; letter-spacing: 0.5px;">
                            [ VIEW_MODE: <span id="mode-text">NATIVE_TERMINAL</span> ]<br>
                            <span id="instruction-text">TOGGLE VISUAL_MODE FOR HIGH-VISIBILITY READING</span>
                        </span>
                        <button id="theme-toggle" class="submit-btn" aria-label="Toggle Theme" style="font-size: 0.75em; padding: 6px 16px; margin-top: 15px;">VISUAL_MODE</button>
                    </div>
                </div>

                <div class="header-title-group" style="text-align: center;">
                    <h1 class="main-title"><span class="typewriter">OTD</span></h1>
                    <h1 class="main-title"><span class="typewriter delay-type">PERSONAL_VAULT</span></h1>
                </div>
            </div>
        </header>

        <section class="hero-container">
            <img src="telescope-clean.jpg" alt="The Watch Tower">
            <div class="text-overlay">
                <h1>The Watch Tower</h1>
                <span class="by-line">by</span>
                <h1>Old Texas Dude&trade;</h1>
            </div>
        </section>

        <section class="vault-manifesto" style="max-width: 700px; margin: 0 auto 40px auto; text-align: center;">
            <h3 style="color: var(--primary); font-size: 0.9rem; letter-spacing: 2px;">[ ACCESS_PURPOSE ]</h3>
            <div style="border-left: 3px solid var(--accent); border-right: 3px solid var(--accent); padding: 20px; background: var(--box-bg);">
                <p>Unfiltered watch_tower reports and observations from <span class="highlight-green">Old Texas Dude™</span>.</p>
                <p style="color: var(--secondary); font-weight: bold; line-height: 1.4; margin-top: 15px;">
                    > FIELD_TESTED<br>
                    <span style="font-size: 1em; display: inline-block; margin: 2px 0;">&Sigma;</span><br>
                    OLD_MAN_APPROVED <
                </p>
            </div>
        </section>

        <nav class="vault-nav-container">
            <div class="primary-feed">
                <button id="btn-watch_tower" onclick="loadLogs('watch_tower', true, this)" class="submit-btn" style="padding: 15px 20px; font-size: 1.1em; min-width: 200px; white-space: normal; height: auto;">ACCESS WATCH TOWER</button>
            </div>
            <div class="secondary-row">
                <label class="review-tag" style="color: var(--primary);">REVIEWS ></label>
                <div class="secondary-filters">
                    <button id="btn-chow" onclick="loadLogs('chow', true, this)" class="submit-btn">CHOW</button>
                    <button id="btn-coord" onclick="loadLogs('coord', true, this)" class="submit-btn">COORD</button>
                    <button id="btn-gear" onclick="loadLogs('gear', true, this)" class="submit-btn">GEAR</button>
                </div>
            </div>
        </nav>

        <main class="vault-layout">
            <section class="log-display">
                <article id="content" class="blog-post">
                    <p class="blink" style="color: var(--accent);">> ESTABLISHING_UPLINK...</p>
                </article>
                <div class="comment-module">
                    <script src="https://utteranc.es/client.js" repo="kdbush64-create/otd-vault" issue-term="pathname" theme="preferred-color-scheme" crossorigin="anonymous" async></script>
                </div>
            </section>

            <aside class="log-directory">
                <h3 style="color: var(--accent); white-space: normal; overflow-wrap: break-word;">> LOG_DIRECTORY</h3>
                <p style="color: var(--primary); font-size: 0.65em; margin: -5px 0 15px 5px; opacity: 0.9; letter-spacing: 0.5px;">
                    [ select entry to load data ]
                </p>
                <ul class="file-list" id="log-list"><li>[ SCANNING_VAULT... ]</li></ul>
                <button id="load-more-btn" onclick="showAllLogs()" class="submit-btn" style="display:none; width: 100%; margin-top: 10px;">
                    [ SHOW_OLDER_LOGS ]
                </button>
                
                <div class="surveillance-wrapper" style="margin-top:20px; background: var(--box-bg); padding: 10px; border: 1px solid var(--border);">
                    <h3 style="color: var(--accent); margin-bottom: 5px;">> VISUAL_UPLINK</h3>
                    <div class="feed-header"><span class="blink">● REC</span><span id="stardate" style="color: var(--secondary); opacity: 0.8; font-size: 0.8em;"></span></div>
                    <div class="feed-container">
                        <behold-widget feed-id="9Bgo9cQPytudmTM356WP"></behold-widget>
                    </div>
                </div>
            </aside>
        </main>

        <footer style="margin-top: 50px; border-top: 2px solid var(--accent); padding: 30px 0;">
            <div style="display: flex; justify-content: space-between; flex-wrap: wrap; gap: 20px;">
                <a href="javascript:void(0)" onclick="loadPost('gear/gear-policy.md')" class="footer-link" style="color: var(--accent); font-weight: bold; text-decoration: none;">[ GEAR_POLICY ]</a>
                <a href="mailto:your-email@example.com" class="footer-link" style="color: var(--primary); text-decoration: none;">[ SEND_FEEDBACK ]</a>
            </div>
            <p style="text-align: center; margin-top: 30px; opacity: 0.7; color: var(--accent);" class="blink">PERSONAL_THOUGHTS_V1.5 // NEON_MODULE_STABLE</p>
        </footer>
    </div>

    <script>
        const repo = "kdbush64-create/otd-vault";
        const DISPLAY_LIMIT = 10;
        const toggleBtn = document.getElementById('theme-toggle');
        const modeText = document.getElementById('mode-text');
        const instructionText = document.getElementById('instruction-text');

        const savedTheme = localStorage.getItem('theme');
        const systemPrefersLight = window.matchMedia('(prefers-color-scheme: light)').matches;
        let currentTheme = savedTheme || (systemPrefersLight ? 'light' : 'dark');

        if (currentTheme === 'light') {
            document.documentElement.setAttribute('data-theme', 'light');
            if (modeText) modeText.innerText = 'FIELD_EXTRACT';
            if (instructionText) instructionText.innerText = 'TOGGLE VISUAL_MODE FOR THE FULL VAULT EXPERIENCE';
        } else {
            if (modeText) modeText.innerText = 'NATIVE_TERMINAL';
            if (instructionText) instructionText.innerText = 'TOGGLE VISUAL_MODE FOR HIGH-VISIBILITY READING';
        }

        toggleBtn.addEventListener('click', () => {
            let theme = document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            
            if (modeText && instructionText) {
                if (theme === 'light') {
                    modeText.innerText = 'FIELD_EXTRACT';
                    instructionText.innerText = 'TOGGLE VISUAL_MODE FOR THE FULL VAULT EXPERIENCE';
                } else {
                    modeText.innerText = 'NATIVE_TERMINAL';
                    instructionText.innerText = 'TOGGLE VISUAL_MODE FOR HIGH-VISIBILITY READING';
                }
            }
        });

        function updateClock() {
            const clock = document.getElementById('stardate');
            if(clock) clock.innerText = new Date().toLocaleTimeString();
        }
        setInterval(updateClock, 1000);
        updateClock();

        async function loadPost(filePath, isManualClick = false) {
            const contentArea = document.getElementById('content');
            contentArea.innerHTML = "<p class='blink' style='color: var(--accent);'>EXTRACTING_DATA_STREAM...</p>";
            
            const cleanPath = filePath.replace('#', '');
            window.location.hash = cleanPath;

            try {
                const response = await fetch(`https://raw.githubusercontent.com/${repo}/main/${cleanPath}?t=${new Date().getTime()}`);
                if (!response.ok) throw new Error('File not found');
                const text = await response.text();
                
                let cleanMarkdown = text;
                if (text.startsWith('---')) {
                    const parts = text.split('---');
                    if (parts.length >= 3) cleanMarkdown = parts.slice(2).join('---').trim();
                }

                // Removed the dynamic header injection.
                // Now we just parse the markdown and manually fix the specific underscore.
                let finalHTML = marked.parse(cleanMarkdown);
                finalHTML = finalHTML.replace(/WATCH_TOWER_REPORT/g, 'WATCH_TOWER REPORT');

                contentArea.innerHTML = `<div class="blog-post-body">${finalHTML}</div>`;
                highlightLogLabels(contentArea);

                if (isManualClick) window.scrollTo({ top: 400, behavior: 'smooth' });
            } catch (err) { 
                contentArea.innerHTML = `<div style="border: 1px dashed #ff0000; padding: 20px; background: rgba(255,0,0,0.1);"><p style="color: #ff0000; font-weight: bold;" class="blink">[!] ERROR: LINK_SEVERED</p></div>`; 
            }
        }

        async function loadLogs(filterFolder, autoLoadFirst = false, btnElement = null) {
            const list = document.getElementById('log-list');
            const loadMoreBtn = document.getElementById('load-more-btn');
            
            document.querySelectorAll('.submit-btn').forEach(btn => btn.classList.remove('active'));
            const targetBtn = btnElement || document.getElementById(`btn-${filterFolder}`);
            if (targetBtn) targetBtn.classList.add('active');

            localStorage.setItem('v64_current_folder', filterFolder);
            list.innerHTML = '<li>[ SCANNING_VAULT... ]</li>';

            try {
                const response = await fetch(`https://api.github.com/repos/${repo}/contents/${filterFolder}?t=${new Date().getTime()}`);
                const files = await response.json();
                const mdFiles = files.filter(f => f.name.endsWith('.md') && !f.name.toLowerCase().includes('template'))
                                     .sort((a, b) => b.name.localeCompare(a.name));

                list.innerHTML = ''; 
                if (mdFiles.length === 0) {
                    list.innerHTML = '<li>[ NO_LOGS_FOUND ]</li>';
                    return;
                }

                const sevenDaysAgo = new Date();
                sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);

                mdFiles.forEach((f, i) => {
                    const li = document.createElement('li');
                    if (i >= DISPLAY_LIMIT) { li.style.display = "none"; li.classList.add('older-log'); }
                    
                    const dateMatch = f.name.match(/\d{4}-\d{2}-\d{2}/);
                    let isNew = false;
                    if (dateMatch) {
                        const fileDate = new Date(dateMatch[0]);
                        isNew = fileDate >= sevenDaysAgo;
                    }

                    const cleanName = f.name.replace('.md', '').toUpperCase().replace(/-/g, ' ');
                    const newBadge = isNew ? `<span class="blink" style="color: #ff0000; font-size: 0.7em; font-weight: bold; margin-right: 8px;">[NEW]</span>` : '';
                    
                    li.innerHTML = `${newBadge}<a href="javascript:void(0)" class="log-link" onclick="loadPost('${f.path}', true)">> ${cleanName}</a>`;
                    list.appendChild(li);
                });
                
                loadMoreBtn.style.display = mdFiles.length > DISPLAY_LIMIT ? "block" : "none";
                if (autoLoadFirst && mdFiles.length > 0) await loadPost(mdFiles[0].path, false);
            } catch (error) { 
                list.innerHTML = "<li>[ ERROR: SCAN_FAILED ]</li>"; 
            }
        }

        function highlightLogLabels(container) {
            const labels = ["STATUS:", "SUMMARY:", "THE_VERDICT:", "RATING:", "OBSERVATION:"];
            const walk = document.createTreeWalker(container, NodeFilter.SHOW_TEXT);
            let node;
            const targets = [];
            while (node = walk.nextNode()) {
                labels.forEach(l => { if (node.nodeValue.includes(l)) targets.push({node, l}); });
            }
            targets.forEach(({node, l}) => {
                const span = `<span class="highlight-green">${l}</span>`;
                const newHTML = node.parentNode.innerHTML.replace(l, span);
                node.parentNode.innerHTML = newHTML;
            });
        }

        function showAllLogs() { 
            document.querySelectorAll('.older-log').forEach(log => log.style.display = "block"); 
            document.getElementById('load-more-btn').style.display = "none"; 
        }

        window.addEventListener('DOMContentLoaded', () => {
            const hash = window.location.hash.replace('#', '');
            const savedFolder = localStorage.getItem('v64_current_folder');

            if (hash && hash.includes('/')) {
                const folder = hash.split('/')[0];
                loadLogs(folder, false).then(() => loadPost(hash));
            } else if (savedFolder) {
                loadLogs(savedFolder, true);
            } else {
                loadLogs('watch_tower', true);
            }
        });

        (() => { const d=document,s=d.createElement("script");s.type="module"; s.src="https://w.behold.so/widget.js";d.head.append(s); })();
    </script>
</body>
</html>
